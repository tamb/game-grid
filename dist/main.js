!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).GameGrid={})}(this,(function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},e.apply(this,arguments)};function i(t,i){window.dispatchEvent(new CustomEvent(t,{detail:e(e({},i),{gameGridInstance:this}),bubbles:!0}))}"function"==typeof SuppressedError&&SuppressedError;var o,s={RENDERED:"gamegrid:grid:rendered",CREATED:"gamegrid:grid:created",DESTROYED:"gamegrid:grid:destroyed",MOVE_LEFT:"gamegrid:move:left",MOVE_RIGHT:"gamegrid:move:right",MOVE_UP:"gamegrid:move:up",MOVE_DOWN:"gamegrid:move:down",MOVE_BLOCKED:"gamegrid:move:blocked",MOVE_COLLISION:"gamegrid:move:collide",MOVE_DETTACH:"gamegrid:move:dettach",MOVE_LAND:"gamegrid:move:land",LIMIT:"gamegrid:move:limit",LIMIT_X:"gamegrid:move:limit:x",LIMIT_Y:"gamegrid:move:limit:y",WRAP:"gamegrid:move:wrap",WRAP_X:"gamegrid:move:wrap:x",WRAP_Y:"gamegrid:move:wrap:y"},r="open",n="barrier",a="interactive",c={activeCoords:[0,0],prevCoords:[0,0],nextCoords:[],currentDirection:"",rendered:!1,moves:[[0,0]]},d="up",l="down",h="left",p="right";!function(t){t.ROW="div",t.CELL="div"}(o||(o={}));var u=function(){function t(t,o){void 0===o&&(o=null);var d=this;this.state=c,this.refs={container:null,rows:[],cells:[]},this.containerFocus=function(){d.options.activeClass&&d.refs.container.classList.add(d.options.activeClass)},this.containerBlur=function(){d.options.activeClass&&d.refs.container.classList.remove(d.options.activeClass)},this.handleKeyDown=function(t){d.options.arrowControls&&("ArrowUp"!==t.code&&"ArrowRight"!==t.code&&"ArrowDown"!==t.code&&"ArrowLeft"!==t.code||(t.preventDefault(),d.handleDirection(t))),d.options.wasdControls&&("KeyW"!==t.code&&"KeyD"!==t.code&&"KeyS"!==t.code&&"KeyA"!==t.code||(t.preventDefault(),d.handleDirection(t)))},this.handleCellClick=function(t){try{if(d.getOptions().clickable&&t.target instanceof HTMLElement){var e=t.target.closest('[data-gamegrid-ref="cell"]');if(e){var i=e.getAttribute("data-gamegrid-coords").split(",").map((function(t){return Number(t)}));d.setFocusToCell.apply(d,i)}else d.setFocusToCell()}}catch(t){throw console.error(t),new Error("Error handling cell click. You possibly have missing attributes")}},this.options=e({activeClass:"gamegrid__cell--active",arrowControls:!0,wasdControls:!0,infiniteX:!0,infiniteY:!0,clickable:!0,rewindLimit:20,blockOnType:[n],collideOnType:[a],moveOnType:[r]},t.options),this.matrix=t.matrix,this.state=e(e({},c),t.state),o&&this.renderGrid(o),i.call(this,s.CREATED)}return t.prototype.updateState=function(t){var i=e(e({},this.state),t);this.state=i},t.prototype.setStateSync=function(t){var e,i,o=this;this.options.middlewares?(null===(e=this.options.middlewares.pre)||void 0===e||e.forEach((function(e){e(o,t)})),this.updateState(t),null===(i=this.options.middlewares.post)||void 0===i||i.forEach((function(e){e(o,t)}))):this.updateState(t)},t.prototype.getState=function(){return this.state},t.prototype.renderGrid=function(t){this.refs={container:t,rows:[],cells:[]},this.render(),this.attachHandlers(),i.call(this,s.RENDERED)},t.prototype.render=function(){var t=this;if(!this.refs||!this.refs.container)throw new Error("No container found");(e=document.createElement("style")).setAttribute("data-testid","gamegrid-styles"),e.innerHTML='\n  .gamegrid * {\n    box-sizing: border-box;\n  }\n  .gamegrid__stage {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n    box-sizing: border-box;\n    border: 1px solid;\n  }\n  .gamegrid__row {\n    display: flex;\n    flex-basis: 100%;\n    max-width: 100%;\n    box-sizing: border-box;\n  }\n  .gamegrid__cell {\n    flex: 1 0 auto;\n    height: auto;\n    overflow: hidden;\n    box-sizing: border-box;\n    border: 1px solid;\n  }\n  .gamegrid__cell--active {\n    outline: 4px solid red;\n  }\n  .gamegrid__cell::before {\n    content: "";\n    float: left;\n    padding-top: 100%;\n  }\n  ',document.head.appendChild(e);var e,i=document.createDocumentFragment();this.renderContainer(),this.matrix.forEach((function(e,o){var s,r=t.renderRow(o);null===(s=t.refs)||void 0===s||s.cells.push([]),e.forEach((function(i,s){var n=t.renderCell(o,s,i,e);r.appendChild(n),t.refs.cells[o].push(n)})),t.refs.rows.push(r),i.appendChild(r)})),this.refs.container.appendChild(i),this.setStateSync({rendered:!0})},t.prototype.renderContainer=function(){this.refs.container.classList.add("gamegrid"),this.refs.container.setAttribute("tabindex","0"),this.refs.container.setAttribute("data-gamegrid-ref","container")},t.prototype.renderRow=function(t){var e=document.createElement(o.ROW);return this.options.rowClass&&e.classList.add(this.options.rowClass),e.setAttribute("data-gamegrid-row-index",t.toString()),e.setAttribute("data-gamegrid-ref","row"),e.classList.add("gamegrid__row"),e},t.prototype.renderCell=function(t,e,i,s){var n,a,c=document.createElement(o.CELL);return a=c,[["data-gamegrid-ref","cell"],["data-gamegrid-row-index",t.toString()],["data-gamegrid-col-index",e.toString()],["data-gamegrid-coords","".concat(t,",").concat(e)],["data-gamegrid-cell-type",i.type||r]].forEach((function(t){var e;"class"===t[0]?(e=a.classList).add.apply(e,t[1].split(" ")):a.setAttribute(t[0],t[1])})),c.style.width="".concat(100/s.length,"%"),null===(n=i.cellAttributes)||void 0===n||n.forEach((function(t){c.setAttribute(t[0],t[1])})),c.classList.add("gamegrid__cell"),c.setAttribute("tabindex",this.options.clickable?"0":"-1"),i.renderFunction&&c.appendChild(i.renderFunction(this)),c},t.prototype.setFocusToCell=function(t,e){var i,o,s=this.refs.cells;if(!s)throw new Error("No cells found");"number"==typeof t&&"number"==typeof e?(s[t][e].focus(),this.removeActiveClasses(),s[t][e].classList.add("gamegrid__cell--active"),this.setStateSync({activeCoords:[t,e]})):(null===(i=this.getActiveCell())||void 0===i||i.focus(),this.removeActiveClasses(),null===(o=this.getActiveCell())||void 0===o||o.classList.add("gamegrid__cell--active"))},t.prototype.removeActiveClasses=function(){this.refs.cells.forEach((function(t){t.forEach((function(t){t.classList.remove("gamegrid__cell--active")}))}))},t.prototype.getActiveCell=function(){return this.refs.cells[this.state.activeCoords[0]][this.state.activeCoords[1]]},t.prototype.moveLeft=function(){this.setStateSync({nextCoords:[this.state.activeCoords[0],this.state.activeCoords[1]-1],currentDirection:h}),i.call(this,s.MOVE_LEFT),this.finishMove()},t.prototype.moveUp=function(){this.setStateSync({nextCoords:[this.state.activeCoords[0]-1,this.state.activeCoords[1]],currentDirection:d}),i.call(this,s.MOVE_UP),this.finishMove()},t.prototype.moveRight=function(){this.setStateSync({nextCoords:[this.state.activeCoords[0],this.state.activeCoords[1]+1],currentDirection:p}),i.call(this,s.MOVE_RIGHT),this.finishMove()},t.prototype.moveDown=function(){this.setStateSync({nextCoords:[this.state.activeCoords[0]+1,this.state.activeCoords[1]],currentDirection:l}),i.call(this,s.MOVE_DOWN),this.finishMove()},t.prototype.addToMoves=function(){var t=function(t,e,i){if(i||2===arguments.length)for(var o,s=0,r=e.length;s<r;s++)!o&&s in e||(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return t.concat(o||Array.prototype.slice.call(e))}([],this.getState().moves,!0);t.unshift(this.state.activeCoords),t.length>this.options.rewindLimit&&t.shift(),this.setStateSync({moves:t})},t.prototype.testLimit=function(){var t=this.state.nextCoords[0],e=this.state.nextCoords[1],o=this.matrix.length-1,r=this.matrix[this.state.activeCoords[0]].length-1;switch(this.state.currentDirection){case l:this.state.nextCoords[0]>o&&(this.options.infiniteY?(t=0,i.call(this,s.WRAP_Y),i.call(this,s.WRAP)):(t=o,i.call(this,s.LIMIT_Y),i.call(this,s.LIMIT)));break;case h:this.state.nextCoords[1]<0&&(this.options.infiniteX?(e=r,i.call(this,s.WRAP_X),i.call(this,s.WRAP)):(e=0,i.call(this,s.LIMIT_X),i.call(this,s.LIMIT)));break;case p:this.state.nextCoords[1]>r&&(this.options.infiniteX?(e=0,i.call(this,s.WRAP_X),i.call(this,s.WRAP)):(e=r,i.call(this,s.LIMIT_X),i.call(this,s.LIMIT)));break;case d:this.state.nextCoords[0]<0&&(this.options.infiniteY?(t=o,i.call(this,s.WRAP_Y),i.call(this,s.WRAP)):(t=0,i.call(this,s.LIMIT_Y),i.call(this,s.LIMIT)))}this.setStateSync({nextCoords:[t,e],activeCoords:[t,e],prevCoords:this.state.activeCoords})},t.prototype.testInteractive=function(){var t,e=this.state.nextCoords;(null===(t=this.matrix[e[0]][e[1]])||void 0===t?void 0:t.type)===a&&i.call(this,s.MOVE_COLLISION)},t.prototype.testBarrier=function(){var t,e=this.state.nextCoords;(null===(t=this.matrix[e[0]][e[1]])||void 0===t?void 0:t.type)===n&&(this.setStateSync({activeCoords:this.state.prevCoords,prevCoords:this.state.activeCoords}),i.call(this,s.MOVE_BLOCKED))},t.prototype.testSpace=function(){var t,e=this.state.nextCoords;(null===(t=this.matrix[e[0]][e[1]])||void 0===t?void 0:t.type)===r&&this.matrix[this.state.prevCoords[0]][this.state.prevCoords[1]].type===a&&i.call(this,s.MOVE_DETTACH)},t.prototype.finishMove=function(){this.testLimit(),this.testSpace(),this.testInteractive(),this.testBarrier(),this.state.rendered&&this.setFocusToCell(),this.addToMoves(),i.call(this,s.MOVE_LAND)},t.prototype.handleDirection=function(t){switch(t.code){case"ArrowLeft":case"KeyA":this.moveLeft();break;case"ArrowUp":case"KeyW":this.moveUp();break;case"ArrowRight":case"KeyD":this.moveRight();break;case"ArrowDown":case"KeyS":this.moveDown()}},t.prototype.getOptions=function(){return this.options},t.prototype.setOptions=function(t){this.options=e(e({},this.options),t)},t.prototype.destroy=function(){this.state.rendered&&this.dettachHandlers()},t.prototype.setMatrix=function(t){this.matrix=t},t.prototype.getMatrix=function(){return this.matrix},t.prototype.attachHandlers=function(){var t=this.refs.container;t&&(t.addEventListener("keydown",this.handleKeyDown),t.addEventListener("focus",this.containerFocus),t.addEventListener("blur",this.containerBlur),t.addEventListener("click",this.handleCellClick))},t.prototype.dettachHandlers=function(){var t=this.refs.container;t&&(t.removeEventListener("keydown",this.handleKeyDown),t.removeEventListener("focus",this.containerFocus),t.removeEventListener("blur",this.containerBlur),t.removeEventListener("click",this.handleCellClick))},t}(),f=s;t.default=u,t.gameGridEventsEnum=f,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=main.js.map
